task :prebuild do |t, args|
	args[:buildtarget].exlibs.push("-lluajit-5.1")
	args[:buildtarget].exlibs.push("-ldl")
end
LIBNAME="yue.so"
task :lib do |t, args|
	libpath = args[:builddir].path + "/" + LIBNAME
	sh "#{CC} -shared -o #{libpath} #{args[:buildtarget].libobjs.join(' ')} #{args[:scanner].lflag}  #{args[:buildtarget].exlibs.join(' ')}"
	sh "make -C ll/lua/test/#{LUA_TEST_MODULE} all"
end
task :lib_clean do |t, args|
	sh "make -C ll/lua/test/#{LUA_TEST_MODULE} clean"
	sh "rm -f #{LIBNAME}"
end

LUAJIT="lj"
LUA_TEST_MODULE="bignum"
task :test do
	sh "../../yue test/_server.lua &"
	sh "sleep 3"
	FileList["test/[a-zA-Z]*.lua"].each do |f|
		sh "#{LUAJIT} #{f}"
	end
	sh "killall yue"
end
