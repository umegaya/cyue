import os
from pprint import pprint

prefix = "/usr/local/"
build_dir = "../.obj/src/"
bin_dir = "../bin/"
(env, bin_name, lib_names) = SConscript("./build.py", variant_dir = build_dir, duplicate = 0)
test_env = env.Clone()
test_env.Append(LIBS = [bin_name], LIBPATH = build_dir)
test_env.Program(build_dir + "ut", Glob("test/*.cpp"))
main_env = env.Clone()
main_env.Append(LIBS = [bin_name], LIBPATH = build_dir)
main_env.Program(build_dir + "yue", Glob("main/*.cpp"))
VariantDir('../bin', ".", duplicate = 0)
so_name = 'lib' + bin_name + env['SHLIBSUFFIX']
Command(bin_dir + bin_name, build_dir + bin_name, Copy("$TARGET", "$SOURCE"))
Command(bin_dir + so_name, build_dir + so_name, Copy("$TARGET", "$SOURCE"))
Command(bin_dir + 'ut', build_dir + 'ut', Copy("$TARGET", "$SOURCE"))
# create install target
env.Alias("install", env.Install(os.path.join(prefix, "bin"), bin_dir + bin_name))
env.Alias("install", env.Install(os.path.join(prefix, "lib"), bin_dir + so_name))

for lib in lib_names:
	libpath = bin_dir + os.path.basename(lib["file"])
	Command(libpath, os.path.join(lib["path"], lib["file"]), Copy("$TARGET", "$SOURCE"))
	# create install target
	env.Alias("install", env.Install(os.path.join(prefix, lib["install_path"]), libpath))

#uninstaller
env.Command("uninstall", None, Delete(FindInstalledFiles()))
