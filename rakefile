LIBDIR = 'lib'
SRCDIR = 'src'
LANG = 'lua'
BIN = 'yue'
LIB = 'yue.so'
LLIB = BIN + 'c.' + LANG



def rake_c(dir, task)
	a = Array.new
	dir.split('/').each do |token|
		token == '.' ? a.push(token) : a.push('..')
	end
	sh "cd #{dir}; rake #{task}; cd #{a.join('/')}"
end

namespace :build do
	def copybin
		sh "mkdir -p #{LIBDIR}"
		sh "cp #{SRCDIR}/#{BIN} #{LIBDIR}/"
		sh "cp #{SRCDIR}/ll/#{LANG}/#{LIB} #{LIBDIR}/"
		sh "cp #{SRCDIR}/ll/#{LANG}/#{LLIB} #{LIBDIR}/"   
	end

	task :clean do
		rake_c(SRCDIR, :clean)
	end
	task :erase do
		rake_c(SRCDIR, :erase)
	end
	task :debug do
		rake_c(SRCDIR, :debug)
		copybin
	end
	task :release do
		rake_c(SRCDIR, :release)
		copybin
	end
end

namespace :test do
	task :ping do
	end
	task :unit do
	end
end

namespace :deploy do
end

task :clean do
	rake_c(SRCDIR, :erase)
	sh "rm -rf #{LIBDIR}/*"
end
