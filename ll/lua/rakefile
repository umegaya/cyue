task :prebuild do |t, args|
	ljlib = ((args[:buildtarget].cfg.to_sym == :debug) ?
		"-lluajit-5.1" : "-lluajit-5.1");
	args[:buildtarget].exlibs.push(ljlib)
	args[:buildtarget].exlibs.push("-ldl")
end
LIBNAME="yue.so"
def get_lflag_for_lib(exlibs)
	r = Array.new
	exlibs.each do |e|
		r.push(e) if !e.index("lua") && !e.index("-ldl")
	end
	exlibs
end
task :lib do |t, args|
	libpath = args[:builddir].path + "/" + LIBNAME
	sh "#{CC} -shared -o #{libpath} #{args[:buildtarget].libobjs.join(' ')} -lstdc++ #{get_lflag_for_lib(args[:buildtarget].exlibs).join(' ')}"
end
