task :prebuild do |t, args|
	ljlib = ((args[:buildtarget].cfg.to_sym == :debug) ?
		"-lluajit-5.1" : "-lluajit-5.1");
	args[:buildtarget].exlibs.push(ljlib)
	args[:buildtarget].exlibs.push("-ldl")
end
LIBNAME="yue.so"
task :lib do |t, args|
	libpath = args[:builddir].path + "/" + LIBNAME
	sh "#{CC} -shared -o #{libpath} #{args[:buildtarget].libobjs.join(' ')} -lstdc++ #{args[:buildtarget].exlibs.join(' ')}"
end

LUAJIT="ljd"
task :test do
	sh "../../yue test/_server.lua &"
	sh "sleep 3"
	FileList["test/[a-zA-Z]*.lua"].each do |f|
		sh "#{LUAJIT} #{f}"
	end
	sh "killall yue"
end
task :test_paas do
	sh "../../yue test/_master.lua &"
	sh "sleep 3"
	sh "../../yue test/_worker.lua &"
	sh "sleep 3"
	sh "killall yue"
end
